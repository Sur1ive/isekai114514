import{d as se,u as ne,Z as ae,o as oe,$ as I,n as ie,c as o,e as q,g,f as e,t as l,i as F,F as f,D as k,p as v,r as j,h as c,j as le,a0 as R,a1 as ce,k as H,a2 as B,a3 as D,a4 as u,Y as A,m as i,_ as re}from"./index-Bpg2grl2.js";import{t as N}from"./tippy-ZR1eBDu5.js";const ue={class:"row"},de={class:"col-md-6 mb-4"},ve={class:"card shadow-sm"},pe={class:"card-header bg-secondary text-white d-flex justify-content-between align-items-center"},me={class:"card-title mb-0"},be={class:"badge bg-primary"},_e={class:"card-body"},he={id:"attribute-bar",class:"list-group list-group-flush"},ye=["data-attr"],ge={class:"fw-bold"},fe={class:"d-flex align-items-center"},ke={class:"text-muted me-2"},xe={key:0,class:"badge bg-success ms-1"},we={key:1,class:"badge bg-danger ms-1"},Te={key:2,class:"badge bg-info ms-1"},qe=["onClick"],Ce={class:"col-md-6 mb-4"},Ae={class:"card shadow-sm"},Ee={class:"card-header bg-secondary text-white"},Pe={class:"card-title mb-0"},$e={class:"card-body"},Me={class:"nav nav-underline mb-3"},Se={class:"nav-item"},Le={class:"nav-item"},Ie={key:0},je={class:"list-group"},He=["data-bs-title","data-bs-content"],Ne={class:"d-flex justify-content-between align-items-center"},ze={key:1},Oe={class:"list-group"},Ve=["data-bs-title","data-bs-content"],Fe={class:"d-flex justify-content-between align-items-center"},Re={class:"col-md-6 mb-4"},Be={class:"card"},De={class:"card-header bg-secondary text-white"},Ue={class:"card-title"},Ke={class:"card-body"},Ye={class:"list-group"},Ze={class:"d-flex align-items-center gap-2"},Ge={class:"fw-bold"},Je=["onClick"],Qe={key:1,class:"badge bg-secondary"},We={class:"col-md-6 mb-4"},Xe={class:"card shadow-sm"},et={class:"card-header bg-secondary text-white"},tt={class:"card-title mb-0"},st={class:"card-body"},nt={class:"nav nav-underline mb-3"},at={class:"nav-item"},ot={class:"nav-item"},it={class:"nav-item"},lt={class:"d-flex flex-wrap gap-2"},ct=["innerHTML"],rt={key:0,class:"text-muted"},ut={class:"row mb-4"},dt={class:"col"},vt={class:"card"},pt={class:"card-header bg-secondary text-white"},mt={class:"card-title"},bt={class:"card-body"},_t={class:"list-group"},ht={class:"fw-bold"},yt={class:"text-muted"},gt={key:1,class:"text-muted"},ft={class:"text-center"},kt=se({__name:"StatusPage",setup(xt){const U=le(),m=ne(),n=g(()=>m.player),y=j("extra"),d=j("all"),b=j(0),x=[],E=new Map,K={str:"力量",dex:"敏捷",con:"体质",int:"智力",siz:"体型",app:"魅力",armor:"护甲",piercing:"穿刺"},Y={str:"影响具有力量系数的动作。大部分的攻击动作都具有力量系数。",dex:"影响具有敏捷系数的动作，一部分迅捷的攻击动作，以及大部分闪避动作都具有敏捷系数。",con:"影响具有体质系数的动作，同时影响生命值上限和自然回复生命值的速度。",int:"影响具有智力系数的动作。",siz:"影响具有体型系数的动作。",app:"暂时没用",armor:"护甲值决定对伤害的减免程度。",piercing:"穿刺值决定攻击时无视目标护甲的能力。"},Z={body:"防具",hand:"武器",foot:"鞋子",accessory:"饰品"},z=["armor","piercing"],G=g(()=>(b.value,n.value?Object.entries(n.value.getAbility()):[])),J=g(()=>(b.value,n.value?Object.entries(n.value.equipments):[]));function C(a){return n.value&&n.value.getExtraAbility()[a]||0}function O(a){return n.value&&n.value.plusAbility[a]||0}const Q=g(()=>(b.value,n.value?[...n.value.getExtraActions()].sort((a,s)=>u[s.actionType].rarity-u[a.actionType].rarity):[])),W=g(()=>(b.value,n.value?[...n.value.actions].sort((a,s)=>u[s.actionType].rarity-u[a.actionType].rarity):[])),P=g(()=>{if(b.value,!n.value)return[];let a=[...n.value.pack];return d.value==="equip"?a=a.filter(s=>s instanceof B):d.value==="consumable"&&(a=a.filter(s=>s instanceof H)),a.sort((s,t)=>t.rarity-s.rarity)});function X(a,s){s?E.set(a,s):E.delete(a)}function V(){x.forEach(a=>a.destroy()),x.length=0}function $(){if(V(),!n.value)return;for(const s of P.value){const t=E.get(s.uuid);if(!t)continue;const r=R(s),p=s instanceof H,S=N(t,{theme:"game",content:`
        ${r}
        <button class="use-item-btn btn btn-success btn-sm mt-1">${p?"使用":"装备"}</button>
        <button class="discard-item-btn btn btn-danger btn-sm mt-1">丢弃</button>
      `,allowHTML:!0,interactive:!0,trigger:"click",hideOnClick:!0,appendTo:document.body,onShown(_){const h=_.popper.querySelector(".use-item-btn"),T=_.popper.querySelector(".discard-item-btn");h==null||h.addEventListener("click",L=>{L.stopPropagation(),_.hide(),s instanceof H?(s.useItem(n.value),n.value.addLog(`${n.value.name} 使用了 ${s.getName()}`)):s instanceof B&&n.value.wearEquipment(s),m.save(),w()}),T==null||T.addEventListener("click",L=>{L.stopPropagation(),_.hide(),n.value.discardItem(s),m.save(),w()})}});x.push(S)}if(n.value)for(const[s,t]of Object.entries(n.value.equipments)){if(!t)continue;const r=R(t),p=document.querySelector(`[data-equip-pos="${s}"]`);if(!p)continue;const S=N(p,{theme:"game",content:`
          ${r}
          <button class="remove-equip-btn btn btn-primary btn-sm mt-1">卸下</button>
        `,allowHTML:!0,interactive:!0,trigger:"click",hideOnClick:!0,appendTo:document.body,onShown(_){const h=_.popper.querySelector(".remove-equip-btn");h==null||h.addEventListener("click",T=>{T.stopPropagation(),_.hide(),n.value.removeEquipment(s),m.save(),w()})}});x.push(S)}document.querySelectorAll("#attribute-bar .list-group-item").forEach(s=>{const t=s.dataset.attr;if(!t)return;const r=Y[t]||"暂无描述",p=N(s,{content:`<div class="p-2">${r}</div>`,allowHTML:!0,theme:"game",placement:"top"});x.push(p)})}function M(){document.querySelectorAll('[data-bs-toggle="popover"]').forEach(a=>{new ce(a)})}function w(){b.value++,m.triggerUpdate(),I(()=>{$(),M()})}function ee(a){if(!(!n.value||n.value.plusAbilityPoint<=0||z.includes(a))){if(n.value.plusAbilityPoint--,n.value.plusAbility[a]++,a==="con"||a==="siz"){const s=n.value.getMaxHealth(),t=n.value.getAbility().con*10+n.value.getAbility().siz*5;n.value.recoverHp(t-s)}m.save(),w()}}function te(a){if(!n.value)return;const s=n.value.equipments[a];s&&confirm(`卸下 ${s.getName()}？`)&&(n.value.removeEquipment(a),m.save(),w())}return ae([y,d],()=>{I(()=>{$(),M()})}),oe(async()=>{await I(),$(),M()}),ie(()=>{V()}),(a,s)=>n.value?(i(),o("div",{key:b.value,class:"container mt-4"},[s[7]||(s[7]=e("h2",{class:"text-center mb-4"},"状态",-1)),e("div",ue,[e("div",de,[e("div",ve,[e("div",pe,[e("h4",me,l(n.value.name)+" 的属性",1),e("div",null,[e("span",be,[s[6]||(s[6]=F("可用加点: ",-1)),e("span",null,l(n.value.plusAbilityPoint),1)])])]),e("div",_e,[e("div",he,[(i(!0),o(f,null,k(G.value,([t,r])=>(i(),o("div",{key:t,class:"list-group-item d-flex justify-content-between align-items-center","data-attr":t},[e("span",ge,l(K[t]||t),1),e("div",fe,[e("span",ke,l(r),1),C(t)>0?(i(),o("span",xe,"+"+l(C(t)),1)):C(t)<0?(i(),o("span",we,l(C(t)),1)):q("",!0),O(t)>0?(i(),o("span",Te,"+"+l(O(t)),1)):q("",!0),!z.includes(t)&&n.value.plusAbilityPoint>0?(i(),o("button",{key:3,class:"btn btn-sm btn-outline-primary ms-1",onClick:p=>ee(t)}," + ",8,qe)):q("",!0)])],8,ye))),128))])])])]),e("div",Ce,[e("div",Ae,[e("div",Ee,[e("h4",Pe,l(n.value.name)+" 的行动列表",1)]),e("div",$e,[e("ul",Me,[e("li",Se,[e("button",{class:v(["nav-link",{active:y.value==="extra"}]),onClick:s[0]||(s[0]=t=>y.value="extra")},"装备额外行动",2)]),e("li",Le,[e("button",{class:v(["nav-link",{active:y.value==="base"}]),onClick:s[1]||(s[1]=t=>y.value="base")},"基础行动",2)])]),y.value==="extra"?(i(),o("div",Ie,[e("ul",je,[(i(!0),o(f,null,k(Q.value,t=>(i(),o("li",{key:t.actionType,class:"list-group-item",tabindex:"0","data-bs-toggle":"popover","data-bs-trigger":"focus","data-bs-html":"true","data-bs-title":c(u)[t.actionType].name,"data-bs-content":c(D)(n.value,c(u)[t.actionType])},[e("div",Ne,[e("span",null,l(c(u)[t.actionType].name),1),e("span",{class:v("badge bg-"+c(A)[c(u)[t.actionType].rarity])},l(t.weight.toFixed(2)),3)])],8,He))),128))])])):(i(),o("div",ze,[e("ul",Oe,[(i(!0),o(f,null,k(W.value,t=>(i(),o("li",{key:t.actionType,class:"list-group-item",tabindex:"0","data-bs-toggle":"popover","data-bs-trigger":"focus","data-bs-html":"true","data-bs-title":c(u)[t.actionType].name,"data-bs-content":c(D)(n.value,c(u)[t.actionType])},[e("div",Fe,[e("span",null,l(c(u)[t.actionType].name),1),e("span",{class:v("badge bg-"+c(A)[c(u)[t.actionType].rarity])},l(t.weight.toFixed(2)),3)])],8,Ve))),128))])]))])])]),e("div",Re,[e("div",Be,[e("div",De,[e("h4",Ue,l(n.value.name)+" 的装备",1)]),e("div",Ke,[e("div",Ye,[(i(!0),o(f,null,k(J.value,([t,r])=>(i(),o("div",{key:t,class:"list-group-item"},[e("div",Ze,[e("span",Ge,l(Z[t]||t),1),r?(i(),o("span",{key:0,class:v("badge bg-"+c(A)[r.rarity]),style:{cursor:"pointer"},onClick:p=>te(t)},l(r.getName()),11,Je)):(i(),o("span",Qe,"空"))])]))),128))])])])]),e("div",We,[e("div",Xe,[e("div",et,[e("h4",tt,l(n.value.name)+" 的背包",1)]),e("div",st,[e("ul",nt,[e("li",at,[e("button",{class:v(["nav-link",{active:d.value==="all"}]),onClick:s[2]||(s[2]=t=>d.value="all")},"全部",2)]),e("li",ot,[e("button",{class:v(["nav-link",{active:d.value==="equip"}]),onClick:s[3]||(s[3]=t=>d.value="equip")},"装备",2)]),e("li",it,[e("button",{class:v(["nav-link",{active:d.value==="consumable"}]),onClick:s[4]||(s[4]=t=>d.value="consumable")},"消耗品",2)])]),e("div",lt,[(i(!0),o(f,null,k(P.value,t=>(i(),o("button",{key:t.uuid,class:v("btn btn-"+c(A)[t.rarity]),ref_for:!0,ref:r=>X(t.uuid,r)},[e("span",{innerHTML:t.getItemIcon()},null,8,ct),F(l(t.getName()),1)],2))),128)),P.value.length===0?(i(),o("p",rt,l(d.value==="all"?"背包为空":d.value==="equip"?"没有装备":"没有道具"),1)):q("",!0)])])])]),e("div",ut,[e("div",dt,[e("div",vt,[e("div",pt,[e("h4",mt,l(n.value.name)+" 的宠物",1)]),e("div",bt,[e("div",_t,[n.value.capturedMonster.length>0?(i(!0),o(f,{key:0},k(n.value.capturedMonster,t=>(i(),o("div",{key:t.name,class:"list-group-item d-flex justify-content-between align-items-center"},[e("span",ht,l(t.name),1),e("span",yt,"Lv. "+l(t.level),1)]))),128)):(i(),o("p",gt,"暂无宠物"))])])])])]),e("div",ft,[e("button",{class:"btn btn-primary",onClick:s[5]||(s[5]=t=>c(U).push({name:"main-menu"}))},"返回主菜单")])])])):q("",!0)}}),qt=re(kt,[["__scopeId","data-v-5d1a48e3"]]);export{qt as default};
