import{E as ce,H as A,G as ne,I as ve,S as Q,J as le,K as q,P as se,L as ye,d as ue,o as be,r as _,n as Ae,O as de,T as _e,f as e,c as f,e as W,t as g,g as K,F as X,Q as we,p as R,h as M,R as he,U as Te,V as Pe,m as h,_ as ge,D as pe,i as z,u as Ne,a as $e,j as Le,W as fe,w as Ee,X as Se,Y as We,B as oe}from"./index-Bpg2grl2.js";function Z(a,o,n){const i=o-n>0?o-n:0;return a*(50/(i+50))}function ie(a,o,n,i,t,u){let c="",s="";return n.category===A.None?c=n.messageGenerator(a,o):c=a.name+ne(n)+'<span style="color: blue;">'+Math.round(t)+"</span> ",i.category===A.None?s=i.messageGenerator(o,a):s=o.name+ne(i)+'<span style="color: orange;">'+Math.round(u)+"</span> ","æ·éª°ï¼š"+c+s}function Ce(a,o,n){function i(t,u){return t.name+"çœ‹èµ·æ¥ä¼¼ä¹ä¼šä½¿ç”¨"+u.name+"<br>"+ce(t,u)}return Math.random()*a.getAbility().int>Math.random()*o.getAbility().int?i(o,n):"ä½ åˆ†è¾¨ä¸å‡º"+o.name+"å³å°†ä½¿ç”¨çš„åŠ¨ä½œ"}var $=(a=>(a.Win="Win",a.Lose="Lose",a.Withdraw="Withdraw",a.EnemyEscape="EnemyEscape",a))($||{}),x=(a=>(a.PlayerWin="PlayerWin",a.EnemyWin="EnemyWin",a.Draw="Draw",a))(x||{});function De(a,o,n,i,t){var y,r;let u=x.Draw;const c=ne(n),s=ne(i);return n.category===A.Capture&&(n.category=A.Attack),n.category===A.Attack&&i.category===A.Attack?u=He(a,o,n,i,t,c,s):n.category===A.Attack&&i.category===A.None||n.category===A.None&&i.category===A.Attack?u=Be(a,o,n,i,t,c,s):n.category===A.Attack&&i.category===A.Defend||n.category===A.Defend&&i.category===A.Attack?u=Ge(a,o,n,i,t,c,s):n.category===A.Dodge&&i.category===A.Attack||n.category===A.Attack&&i.category===A.Dodge?u=Oe(a,o,n,i,t,c,s):(t.push({playerName:a.name,enemyName:o.name,playerHitIcon:c,enemyHitIcon:s,playerPower:-1,enemyPower:-1,result:x.Draw,isNothing:!0,resultMessage:"æ— äº‹å‘ç”Ÿ",damage:0,damageTarget:"none",playerHpAfter:0,enemyHpAfter:0}),a.addTempLog("æ— äº‹å‘ç”Ÿ("+a.name+c+" "+o.name+s+")")),u===x.PlayerWin?(y=n.extraEffect)==null||y.call(n,a,o):u===x.EnemyWin&&((r=i.extraEffect)==null||r.call(i,o,a)),u}function Ie(a,o,n,i){const t=[];a.addTempLog(a.name+"ä½¿ç”¨äº†"+n.name+"ï¼Œ"+o.name+"ä½¿ç”¨äº†"+i.name);let u=0;for(;n.hits[u]||i.hits[u];){let c=n.hits[u]||ve,s=i.hits[u]||ve;a.statuses.sort((r,v)=>r.priority-v.priority).forEach(r=>{if(r.category===Q.OnHitStart){const v=le[r.type].effect;c=v(a,c,r.statusLevel)}}),o.statuses.sort((r,v)=>r.priority-v.priority).forEach(r=>{if(r.category===Q.OnHitStart){const v=le[r.type].effect;s=v(o,s,r.statusLevel)}}),a.updateStatusesOnHitStart(),o.updateStatusesOnHitStart();const y=De(a,o,c,s,t);if(t.length>0){const r=t[t.length-1];r.playerHpAfter=Math.ceil(a.health),r.enemyHpAfter=Math.ceil(o.health)}c.continuous&&y!==x.PlayerWin&&(n.hits.splice(u+1),a.addTempLog(a.name+"çš„è¿ç»­hitä¸­æ–­")),s.continuous&&y!==x.EnemyWin&&(i.hits.splice(u+1),a.addTempLog(o.name+"çš„è¿ç»­hitä¸­æ–­")),u++}return a.clearStatusByCategory(Q.OnHitStart),o.clearStatusByCategory(Q.OnHitStart),t}function He(a,o,n,i,t,u,c){const s=q(n.coeff,a.getAbility(),a.getActionCoeff(n.category)),y=q(i.coeff,o.getAbility(),o.getActionCoeff(i.category));a.addTempLog(ie(a,o,n,i,s,y));let r,v,p,k;return s>=y?(r=x.PlayerWin,p=Z(s,o.getAbility().armor,a.getAbility().piercing),o.loseHp(p),v=n.messageGenerator(a,o),k="enemy",a.addTempLog(v+'é€ æˆäº†<span style="color: red;">'+Math.round(p)+"</span>ç‚¹ä¼¤å®³")):(r=x.EnemyWin,p=Z(y,a.getAbility().armor,o.getAbility().piercing),a.loseHp(p),v=i.messageGenerator(o,a),k="player",a.addTempLog(v+'é€ æˆäº†<span style="color: red;">'+Math.round(p)+"</span>ç‚¹ä¼¤å®³")),t.push({playerName:a.name,enemyName:o.name,playerHitIcon:u,enemyHitIcon:c,playerPower:Math.round(s),enemyPower:Math.round(y),result:r,isNothing:!1,resultMessage:v,damage:Math.round(p),damageTarget:k,playerHpAfter:0,enemyHpAfter:0}),r}function Be(a,o,n,i,t,u,c){let s,y,r;i.category===A.None?(s=a,y=o,r=n):(s=o,y=a,r=i);const v=q(r.coeff,s.getAbility(),s.getActionCoeff(r.category));a.addTempLog(ie(a,o,n,i,s.isPlayer?v:0,s.isPlayer?v:0));const p=Z(v,y.getAbility().armor,s.getAbility().piercing);y.loseHp(p);const k=r.messageGenerator(s,y);a.addTempLog(k+'é€ æˆäº†<span style="color: red;">'+Math.round(p)+"</span>ç‚¹ä¼¤å®³");const P=s instanceof se?x.PlayerWin:x.EnemyWin;return t.push({playerName:a.name,enemyName:o.name,playerHitIcon:u,enemyHitIcon:c,playerPower:s instanceof se?Math.round(v):-1,enemyPower:s instanceof se?-1:Math.round(v),result:P,isNothing:!1,resultMessage:k,damage:Math.round(p),damageTarget:s instanceof se?"enemy":"player",playerHpAfter:0,enemyHpAfter:0}),P}function Ge(a,o,n,i,t,u,c){const s=q(n.coeff,a.getAbility(),a.getActionCoeff(n.category)),y=q(i.coeff,o.getAbility(),o.getActionCoeff(i.category)),r=n.category===A.Attack,v=r?a:o,p=r?o:a,k=r?n:i,P=r?i:n,I=r?s:y,N=r?y:s,L=I-N>0?I-N:0;a.addTempLog(ie(a,o,n,i,s,y));const E=Z(L,p.getAbility().armor,v.getAbility().piercing);p.loseHp(E);let T,d,V;return L>0?(T=r?x.PlayerWin:x.EnemyWin,d=k.messageGenerator(v,p)+`å‡»ç©¿äº†${p.name}çš„é˜²å¾¡`,V=p===a?"player":"enemy",a.addTempLog(k.messageGenerator(v,p)+`å‡»ç©¿äº†${p.name}çš„é˜²å¾¡ï¼Œé€ æˆäº†<span style="color: red;">`+Math.round(E)+`(-${Math.round(N)})</span>ç‚¹ä¼¤å®³`)):(T=r?x.EnemyWin:x.PlayerWin,d=P.messageGenerator(p,v)+"ï¼Œ"+k.messageGenerator(v,p)+"ä½†æ²¡æœ‰é€ æˆä¼¤å®³",V="none",a.addTempLog(P.messageGenerator(p,v)+","+k.messageGenerator(v,p)+"ä½†æ²¡æœ‰é€ æˆä¼¤å®³")),t.push({playerName:a.name,enemyName:o.name,playerHitIcon:u,enemyHitIcon:c,playerPower:Math.round(s),enemyPower:Math.round(y),result:T,isNothing:!1,resultMessage:d,damage:Math.round(E),damageTarget:V,playerHpAfter:0,enemyHpAfter:0}),T}function Oe(a,o,n,i,t,u,c){const s=q(n.coeff,a.getAbility(),a.getActionCoeff(n.category)),y=q(i.coeff,o.getAbility(),o.getActionCoeff(i.category)),r=n.category===A.Attack,v=r?a:o,p=r?o:a,k=r?n:i,P=r?i:n,I=r?s:y,N=r?y:s;a.addTempLog(ie(a,o,n,i,s,y));let L,E,T=0,d;return I>N?(L=r?x.PlayerWin:x.EnemyWin,T=Z(I,p.getAbility().armor,v.getAbility().piercing),p.loseHp(T),E=k.messageGenerator(v,p),d=p===a?"player":"enemy",a.addTempLog(E+"å¯¹"+p.name+'é€ æˆäº†<span style="color: red;">'+Math.round(T)+"</span>ç‚¹ä¼¤å®³")):(L=r?x.EnemyWin:x.PlayerWin,v.addStatus(ye.Unbalance,1),E=P.messageGenerator(p,v)+"ï¼Œ"+v.name+"å¤±è¡¡äº†",d="none",a.addTempLog(P.messageGenerator(p,v)+","+v.name+"å¤±è¡¡äº†")),t.push({playerName:a.name,enemyName:o.name,playerHitIcon:u,enemyHitIcon:c,playerPower:Math.round(s),enemyPower:Math.round(y),result:L,isNothing:!1,resultMessage:E,damage:Math.round(T),damageTarget:d,playerHpAfter:0,enemyHpAfter:0}),L}const Re={class:"dice-content"},Ve={class:"dice-action-names"},ze={class:"action-player"},Ue={class:"action-enemy"},je={class:"dice-header"},Fe={class:"dice-arena"},qe={class:"dice-name player-color"},Je={class:"dice-icon-display"},Ke={key:0,class:"dice-na"},Qe={key:1,class:"dice-number"},Xe={key:2,class:"dice-na"},Ye={class:"hp-bar-wrapper"},Ze={class:"hp-bar-bg"},et={class:"hp-bar-text"},tt={class:"dice-name enemy-color"},at={class:"dice-icon-display"},st={key:0,class:"dice-na"},ot={key:1,class:"dice-number"},nt={key:2,class:"dice-na"},lt={class:"hp-bar-wrapper"},it={class:"hp-bar-bg"},rt={class:"hp-bar-text"},ct={key:0,class:"dice-result-section"},dt={key:0,class:"dice-nothing-result"},ut=["innerHTML"],gt={class:"damage-icon"},mt={class:"damage-target-name"},vt={class:"damage-number"},ht={key:3,class:"dice-no-damage"},pt={class:"dice-hint"},ft=ue({__name:"DiceOverlay",props:{rolls:{},playerActionName:{},enemyActionName:{},playerHpStart:{},enemyHpStart:{},playerMaxHp:{},enemyMaxHp:{},autoMode:{type:Boolean}},emits:["complete"],setup(a,{emit:o}){const n=x.PlayerWin,i=x.EnemyWin,t=a,u=o,c=_(0),s=_("idle"),y=_(0),r=_(0),v=_(0),p=_(0),k=K(()=>t.playerMaxHp>0?Math.max(0,v.value/t.playerMaxHp*100):0),P=K(()=>t.enemyMaxHp>0?Math.max(0,p.value/t.enemyMaxHp*100):0);function I(m){return m>50?"#2ed573":m>25?"#ffa502":"#ff4757"}let N,L,E,T;const d=K(()=>t.rolls[c.value]??null),V=K(()=>s.value==="result"&&!t.autoMode?"ç‚¹å‡»ç»§ç»­":"ç‚¹å‡»åŠ é€Ÿ"),ee=K(()=>{const m=d.value;return m?m.damageTarget==="player"?m.playerName:m.damageTarget==="enemy"?m.enemyName:"":""});function H(){N!==void 0&&clearInterval(N),L!==void 0&&clearTimeout(L),E!==void 0&&clearTimeout(E),T!==void 0&&clearTimeout(T),N=void 0,L=void 0,E=void 0,T=void 0}function J(){H();const m=d.value;if(!m){u("complete");return}if(m.isNothing){s.value="idle",L=window.setTimeout(()=>{s.value="result",v.value=m.playerHpAfter,p.value=m.enemyHpAfter,t.autoMode&&(T=window.setTimeout(()=>{O()},800))},500);return}Y()}function Y(){H();const m=d.value;if(!m)return;s.value="rolling";const C=Math.max(m.playerPower>0?m.playerPower:10,m.enemyPower>0?m.enemyPower:10),j=Math.max(Math.ceil(C*1.5),20);N=window.setInterval(()=>{m.playerPower>=0&&(y.value=Math.floor(Math.random()*j)),m.enemyPower>=0&&(r.value=Math.floor(Math.random()*j))},70),L=window.setTimeout(()=>{N!==void 0&&clearInterval(N),N=void 0,y.value=m.playerPower>=0?m.playerPower:0,r.value=m.enemyPower>=0?m.enemyPower:0,s.value="settled",E=window.setTimeout(()=>{G(m)},400)},1200)}function G(m){s.value="result",v.value=m.playerHpAfter,p.value=m.enemyHpAfter,t.autoMode&&(T=window.setTimeout(()=>{O()},1200))}function O(){H(),c.value<t.rolls.length-1?(c.value++,J()):u("complete")}function U(){const m=d.value;if(!m){u("complete");return}s.value==="rolling"?(H(),m.playerPower>=0&&(y.value=m.playerPower),m.enemyPower>=0&&(r.value=m.enemyPower),G(m),t.autoMode&&(H(),T=window.setTimeout(()=>{O()},400))):s.value==="settled"?(H(),G(m),t.autoMode&&(H(),T=window.setTimeout(()=>{O()},400))):s.value==="result"&&(H(),O())}return be(()=>{v.value=t.playerHpStart,p.value=t.enemyHpStart,J()}),Ae(()=>{H()}),(m,C)=>(h(),de(_e,{to:"body"},[e("div",{class:"dice-overlay",onClick:U},[C[4]||(C[4]=e("div",{class:"dice-backdrop"},null,-1)),e("div",Re,[e("div",Ve,[e("span",ze,g(a.playerActionName),1),C[0]||(C[0]=e("span",{class:"action-vs"},"vs",-1)),e("span",Ue,g(a.enemyActionName),1)]),e("div",je," ç¬¬ "+g(c.value+1)+" / "+g(a.rolls.length)+" æ¬¡æ‹¼ç‚¹ ",1),d.value?(h(),f(X,{key:0},[e("div",Fe,[e("div",{class:R(["dice-side",{"side-damaged":s.value==="result"&&d.value.damageTarget==="player"&&d.value.damage>0}])},[e("div",qe,g(d.value.playerName),1),e("div",Je,g(d.value.playerHitIcon),1),e("div",{class:R(["dice-box player-box",{rolling:!d.value.isNothing&&s.value==="rolling",winner:!d.value.isNothing&&s.value==="result"&&d.value.result===M(n),loser:!d.value.isNothing&&s.value==="result"&&d.value.result===M(i),"nothing-box":d.value.isNothing}])},[d.value.isNothing?(h(),f("span",Ke,"â€”")):d.value.playerPower>=0?(h(),f("span",Qe,g(y.value),1)):(h(),f("span",Xe,"â€”"))],2),e("div",Ye,[e("div",Ze,[e("div",{class:"hp-bar-fill",style:he({width:k.value+"%",background:I(k.value)})},null,4)]),e("div",et,g(v.value)+" / "+g(a.playerMaxHp),1)])],2),C[1]||(C[1]=e("div",{class:"dice-vs"},"VS",-1)),e("div",{class:R(["dice-side",{"side-damaged":s.value==="result"&&d.value.damageTarget==="enemy"&&d.value.damage>0}])},[e("div",tt,g(d.value.enemyName),1),e("div",at,g(d.value.enemyHitIcon),1),e("div",{class:R(["dice-box enemy-box",{rolling:!d.value.isNothing&&s.value==="rolling",winner:!d.value.isNothing&&s.value==="result"&&d.value.result===M(i),loser:!d.value.isNothing&&s.value==="result"&&d.value.result===M(n),"nothing-box":d.value.isNothing}])},[d.value.isNothing?(h(),f("span",st,"â€”")):d.value.enemyPower>=0?(h(),f("span",ot,g(r.value),1)):(h(),f("span",nt,"â€”"))],2),e("div",lt,[e("div",it,[e("div",{class:"hp-bar-fill",style:he({width:P.value+"%",background:I(P.value)})},null,4)]),e("div",rt,g(p.value)+" / "+g(a.enemyMaxHp),1)])],2)]),we(Pe,{name:"result-slide"},{default:Te(()=>[s.value==="result"?(h(),f("div",ct,[C[3]||(C[3]=e("div",{class:"dice-result-divider"},null,-1)),d.value.isNothing?(h(),f("div",dt," æ— äº‹å‘ç”Ÿ ")):(h(),f("div",{key:1,class:"dice-result-message",innerHTML:d.value.resultMessage},null,8,ut)),!d.value.isNothing&&d.value.damage>0?(h(),f("div",{key:2,class:R(["dice-damage",{"damage-to-player":d.value.damageTarget==="player","damage-to-enemy":d.value.damageTarget==="enemy"}])},[e("span",gt,g(d.value.damageTarget==="player"?"ğŸ’”":"ğŸ’¥"),1),e("span",mt,g(ee.value),1),e("span",vt,"-"+g(d.value.damage),1),C[2]||(C[2]=e("span",{class:"damage-label"},"HP",-1))],2)):!d.value.isNothing&&d.value.damage===0&&d.value.damageTarget==="none"?(h(),f("div",ht," ğŸ›¡ï¸ æœªé€ æˆä¼¤å®³ ")):W("",!0)])):W("",!0)]),_:1})],64)):W("",!0),e("div",pt,g(V.value),1)])])]))}}),yt=ge(ft,[["__scopeId","data-v-6e04590b"]]),bt={class:"blog-content"},_t={key:0,class:"blog-empty"},wt={class:"blog-round-header"},Mt={class:"blog-round-divider"},xt={class:"blog-round-label"},kt={class:"blog-round-actions"},At={class:"blog-action-player"},Tt={class:"blog-action-enemy"},Pt={class:"blog-hit-overview"},Nt={class:"blog-hit-left"},$t={class:"blog-icon"},Lt={class:"blog-hit-center"},Et={class:"blog-hit-right"},St={class:"blog-icon"},Wt={key:0,class:"blog-hit-detail"},Ct=["innerHTML"],Dt={key:1,class:"blog-no-damage"},It={key:1,class:"blog-hit-detail blog-nothing-detail"},Ht=ue({__name:"BattleLogContent",props:{rounds:{}},setup(a){const o=x.PlayerWin,n=x.EnemyWin;return(i,t)=>(h(),f("div",bt,[a.rounds.length===0?(h(),f("div",_t,"æš‚æ— æˆ˜æ–—è®°å½•")):W("",!0),(h(!0),f(X,null,pe(a.rounds,u=>(h(),f("div",{key:u.roundNumber,class:"blog-round"},[e("div",wt,[e("div",Mt,[e("span",xt,"å›åˆ "+g(u.roundNumber),1)]),e("div",kt,[e("span",At,g(u.playerActionName),1),t[0]||(t[0]=e("span",{class:"blog-action-vs"},"vs",-1)),e("span",Tt,g(u.enemyActionName),1)])]),(h(!0),f(X,null,pe(u.rolls,(c,s)=>(h(),f("div",{key:s,class:"blog-hit"},[e("div",Pt,[e("div",Nt,[e("span",$t,g(c.playerHitIcon),1),!c.isNothing&&c.playerPower>=0?(h(),f("span",{key:0,class:R(["blog-power",{"power-win":c.result===M(o),"power-lose":c.result===M(n)}])},g(c.playerPower),3)):W("",!0)]),e("div",Lt,[c.isNothing?(h(),f(X,{key:0},[z("â€”")],64)):(h(),f(X,{key:1},[z("vs")],64))]),e("div",Et,[!c.isNothing&&c.enemyPower>=0?(h(),f("span",{key:0,class:R(["blog-power",{"power-win":c.result===M(n),"power-lose":c.result===M(o)}])},g(c.enemyPower),3)):W("",!0),e("span",St,g(c.enemyHitIcon),1)])]),c.isNothing?(h(),f("div",It," æ— äº‹å‘ç”Ÿ ")):(h(),f("div",Wt,[e("div",{class:"blog-message",innerHTML:c.resultMessage},null,8,Ct),c.damage>0?(h(),f("div",{key:0,class:R(["blog-damage",c.damageTarget==="player"?"dmg-player":"dmg-enemy"])},g(c.damageTarget==="player"?"ğŸ’”":"ğŸ’¥")+" "+g(c.damageTarget==="player"?c.playerName:c.enemyName)+" -"+g(c.damage)+" HP ",3)):c.damage===0&&c.damageTarget==="none"?(h(),f("div",Dt," ğŸ›¡ï¸ æœªé€ æˆä¼¤å®³ ")):W("",!0)]))]))),128))]))),128))]))}}),Bt=ge(Ht,[["__scopeId","data-v-d6d0a94d"]]),Gt={key:0},Ot={class:"form-check form-switch"},Rt={class:"form-check-label",for:"autoModeSwitch"},Vt={class:"settings-desc"},zt={class:"container mt-4"},Ut={class:"card mb-3"},jt={class:"card-header bg-danger text-white"},Ft={class:"mb-0"},qt={style:{"font-size":"12px","margin-left":"10px"},class:"badge bg-secondary"},Jt={class:"card-body"},Kt=["innerHTML"],Qt=["innerHTML"],Xt={class:"card-text"},Yt={class:"card mb-4"},Zt={class:"card-header bg-success text-white"},ea={class:"mb-0"},ta={class:"card-body"},aa={class:"card-text"},sa={key:0,class:"row mb-4"},oa={class:"col-6"},na={class:"card-body text-center"},la={class:"card-title"},ia={class:"card-text fst-italic"},ra=["innerHTML"],ca={class:"col-6"},da={class:"card-body text-center"},ua={class:"card-title"},ga={class:"card-text fst-italic"},ma=["innerHTML"],va={key:1},ha={class:"container mt-4"},pa={class:"card text-center shadow"},fa={class:"card-body"},ya={class:"card-title"},ba={key:0,class:"text-success"},_a={key:1,class:"text-danger"},wa={key:2,class:"text-warning"},Ma={key:3,class:"text-warning"},xa={key:4},ka={class:"text-info"},Aa={key:0},Ta={class:"battle-log-panel"},Pa={class:"battle-log-header"},Na={class:"battle-log-body"},$a=ue({__name:"BattlePage",setup(a){const o=Le(),n=Ne(),i=$e(),t=n.player;let u=null;const c=_(0),s=K(()=>(c.value,u)),y=_(null),r=_(null),v=_(null),p=_(""),k=_(!1),P=_(null),I=_(!1),N=_(null),L=_([]),E=_(""),T=_(""),d=_(0),V=_(0),ee=_(0),H=_(0),J=_(!1),Y=_(!1),G=_(!1),O=_([]),U=_(!1),m=_(localStorage.getItem("battleDiceAutoMode")==="true");function C(){localStorage.setItem("battleDiceAutoMode",String(m.value))}function j(){c.value++}be(()=>{if(!i.enemy||!t){o.push({name:"main-menu"});return}u=i.enemy,j(),t.isAtHome=!1,te()});function me(w){if(Y.value)return;const l=w,b=v.value,D=u,F=Math.ceil(t.health),S=Math.ceil(D.health);t.addTempLog("--------------------------å›åˆ-----------------------------");const B=Ie(t,D,l,b);O.value.push({roundNumber:O.value.length+1,playerActionName:l.name,enemyActionName:b.name,rolls:[...B]}),B.length>0?(L.value=B,E.value=l.name,T.value=b.name,d.value=F,V.value=S,ee.value=t.getMaxHealth(),H.value=D.getMaxHealth(),J.value=!0,Y.value=!0):te()}function Me(){J.value=!1,Y.value=!1,j(),te()}function te(){const w=u;let l=w.getRandomAction();const b=Ce(t,w,l);let D=t.getRandomAction(),F=t.getRandomAction();if(t.statuses.sort((S,B)=>S.priority-B.priority).forEach(S=>{if(S.category===Q.OnTurnStart){const B=le[S.type].effect,re=B(t,D,F);D=re.action1,F=re.action2}}),w.statuses.sort((S,B)=>S.priority-B.priority).forEach(S=>{if(S.category===Q.OnTurnStart){const B=le[S.type].effect;l=B(w,l,l).action1}}),t.updateStatusesOnTurnStart(),w.updateStatusesOnTurnStart(),t.health<=0){t.addLog(t.name+"æ’‘ä¸ä½äº†"),t.clearStatus(),ae($.Lose);return}if(w.health<1){t.addLog(t.name+"å‡»è´¥äº†"+w.name),t.clearStatus(),ae($.Win);return}if(w.statuses.some(S=>S.type===ye.Escaped)){t.addLog(w.name+"é€ƒè·‘äº†"),ae($.EnemyEscape);return}n.save(),y.value=D,r.value=F,v.value=l,p.value=b,j()}function xe(){ae($.Withdraw)}function ae(w){const l=u;if(I.value=!1,N.value=null,w===$.Win){const b=l.randomDropItem();b&&(b.showItemToast(),N.value=b),t.exp+=Math.floor(l.giveExp),I.value=t.checkLevelUp(),t.exp=Math.floor(t.exp),t.addLog(l.name+"æ‰è½äº†<span style='color: gold;'>"+((b==null?void 0:b.name)??"æ— ")+"</span>"),b&&t.pack.push(b)}else w===$.Lose?(t.health=1,t.addLog(t.name+"æ‹¼æ­»ä»"+l.name+"çš„æ‰‹ä¸­é€ƒäº†å‡ºæ¥ï¼Œæ‹–ç€æ®‹ç ´çš„èº«èº¯ï¼Œå›åˆ°äº†åŸé•‡")):w===$.Withdraw?t.addLog(t.name+"åœ¨ä¸"+l.name+"çš„æˆ˜æ–—ä¸­é€ƒè·‘äº†"):w===$.EnemyEscape&&t.addLog(l.name+"é€ƒè·‘äº†");P.value=w,k.value=!0}function ke(){const w=P.value,l=u,b=i.context;if(t.clearTempLogs(),n.save(),b===oe.Boss)if(w===$.Lose||w===$.Withdraw){const D=t.currentMapData.boss[0],F=D.health,S=l.health;F-S>l.getMaxHealth()*.2&&(D.health=S),n.save(),o.push({name:"main-menu"})}else{if(t.currentMapData.boss.shift(),t.currentMapData.boss.length>0){const D=t.currentMapData.boss[0];u=D,j(),i.startBattle(D,oe.Boss),k.value=!1,P.value=null,te();return}t.currentMapData.goingToNodeId?(t.goToNode(t.currentMapData.goingToNodeId),o.push({name:"map"})):o.push({name:"main-menu"})}else b===oe.NormalMonster?w===$.Lose||w===$.Withdraw||!t.currentMapData.goingToNodeId?o.push({name:"main-menu"}):(t.goToNode(t.currentMapData.goingToNodeId),o.push({name:"map"})):b===oe.StartPage&&(i.lastResult=w,o.push({name:"start",query:{afterBattle:w===$.Win?"win":"lose"}}))}return(w,l)=>(h(),f(X,null,[!k.value&&s.value&&M(t)?(h(),f("div",Gt,[e("button",{type:"button",class:"btn btn-primary",style:{position:"absolute",left:"20px",top:"80px","z-index":"999"},onClick:xe}," é€ƒè·‘ "),e("button",{type:"button",class:"btn btn-dark",style:{position:"absolute",right:"20px",top:"80px","z-index":"999"},onClick:l[0]||(l[0]=b=>G.value=!0)}," ğŸ“œ è®°å½• "),e("button",{type:"button",class:"btn btn-dark",style:{position:"absolute",right:"20px",top:"125px","z-index":"999"},onClick:l[1]||(l[1]=b=>U.value=!U.value)}," âš™ï¸ è®¾ç½® "),U.value?(h(),f("div",{key:0,style:{position:"fixed",top:"0",left:"0",width:"100vw",height:"100vh","z-index":"999"},onClick:l[2]||(l[2]=b=>U.value=!1)})):W("",!0),U.value?(h(),f("div",{key:1,class:"battle-settings-panel",onClick:l[4]||(l[4]=fe(()=>{},["stop"]))},[l[10]||(l[10]=e("div",{class:"settings-title"},"æˆ˜æ–—è®¾ç½®",-1)),e("div",Ot,[Ee(e("input",{id:"autoModeSwitch","onUpdate:modelValue":l[3]||(l[3]=b=>m.value=b),class:"form-check-input",type:"checkbox",onChange:C},null,544),[[Se,m.value]]),e("label",Rt,g(m.value?"è‡ªåŠ¨æ·éª°":"æ‰‹åŠ¨æ·éª°"),1)]),e("div",Vt,g(m.value?"æ·éª°åŠ¨ç”»è‡ªåŠ¨æ’­æ”¾ï¼Œç‚¹å‡»å¯åŠ é€Ÿ":"æ¯æ¬¡æ‹¼ç‚¹éœ€è¦æ‰‹åŠ¨ç‚¹å‡»è§¦å‘"),1)])):W("",!0),e("div",zt,[l[13]||(l[13]=e("h2",{class:"text-center mb-3"},"æˆ˜æ–—",-1)),e("div",Ut,[e("div",jt,[e("h4",Ft,[z(g(s.value.name)+" ",1),e("span",qt,"lv."+g(s.value.level),1)])]),e("div",Jt,[e("p",{class:"card-text fst-italic",innerHTML:'"'+s.value.description+'"'},null,8,Kt),e("p",{class:"card-text",innerHTML:p.value},null,8,Qt),e("p",Xt,[l[11]||(l[11]=z("HP: ",-1)),e("strong",null,g(Math.ceil(s.value.health)),1)])])]),l[14]||(l[14]=e("hr",null,null,-1)),e("div",Yt,[e("div",Zt,[e("h4",ea,g(M(t).name),1)]),e("div",ta,[e("p",aa,[l[12]||(l[12]=z("HP: ",-1)),e("strong",null,g(Math.ceil(M(t).health)),1)])])]),y.value&&r.value?(h(),f("div",sa,[e("div",oa,[e("div",{class:"card bg-primary text-white",style:{cursor:"pointer"},onClick:l[5]||(l[5]=b=>me(y.value))},[e("div",na,[e("h5",la,g(y.value.name),1),e("p",ia,'"'+g(y.value.description)+'"',1),e("p",{class:"card-text",innerHTML:M(ce)(M(t),y.value)},null,8,ra)])])]),e("div",ca,[e("div",{class:"card bg-info text-white",style:{cursor:"pointer"},onClick:l[6]||(l[6]=b=>me(r.value))},[e("div",da,[e("h5",ua,g(r.value.name),1),e("p",ga,'"'+g(r.value.description)+'"',1),e("p",{class:"card-text",innerHTML:M(ce)(M(t),r.value)},null,8,ma)])])])])):W("",!0)])])):k.value&&s.value&&M(t)?(h(),f("div",va,[e("div",ha,[e("div",pa,[l[18]||(l[18]=e("div",{class:"card-header bg-dark text-white"},[e("h2",{class:"mb-0"},"æˆ˜æ–—ç»“æŸ")],-1)),e("div",fa,[e("h4",ya,[z(g(M(t).name)+" ",1),P.value===M($).Win?(h(),f("span",ba,"èƒœåˆ©")):P.value===M($).Lose?(h(),f("span",_a,"å¤±è´¥")):P.value===M($).EnemyEscape?(h(),f("span",wa,"æ•Œäººé€ƒè·‘äº†")):(h(),f("span",Ma,"é€ƒè·‘")),e("p",null," lv: "+g(M(t).level)+g(I.value?"ğŸ”º":"")+" exp: "+g(M(t).exp)+"/"+g(M(t).getNextLevelExp()),1),P.value===M($).Win?(h(),f("p",xa,[l[16]||(l[16]=z(" è·å¾—ç»éªŒ: ",-1)),e("span",ka,g(Math.floor(s.value.giveExp)),1),N.value?(h(),f("span",Aa,[l[15]||(l[15]=z(" è·å¾—ç‰©å“: ",-1)),e("span",{class:R("text-"+M(We)[N.value.rarity])},g(N.value.name),3)])):W("",!0)])):W("",!0)]),l[17]||(l[17]=e("hr",null,null,-1)),e("button",{class:"btn btn-dark",onClick:l[7]||(l[7]=b=>G.value=!0)},"ğŸ“œ æˆ˜æ–—è®°å½•")]),e("div",{class:"card-footer"},[e("button",{class:"btn btn-primary",onClick:ke},"ç»§ç»­")])])])])):W("",!0),J.value?(h(),de(yt,{key:2,rolls:L.value,"player-action-name":E.value,"enemy-action-name":T.value,"player-hp-start":d.value,"enemy-hp-start":V.value,"player-max-hp":ee.value,"enemy-max-hp":H.value,"auto-mode":m.value,onComplete:Me},null,8,["rolls","player-action-name","enemy-action-name","player-hp-start","enemy-hp-start","player-max-hp","enemy-max-hp","auto-mode"])):W("",!0),(h(),de(_e,{to:"body"},[G.value?(h(),f("div",{key:0,class:"battle-log-overlay",onClick:l[9]||(l[9]=fe(b=>G.value=!1,["self"]))},[e("div",Ta,[e("div",Pa,[l[19]||(l[19]=e("h5",{class:"mb-0"},"æˆ˜æ–—è®°å½•",-1)),e("button",{type:"button",class:"btn-close btn-close-white","aria-label":"å…³é—­",onClick:l[8]||(l[8]=b=>G.value=!1)})]),e("div",Na,[we(Bt,{rounds:O.value},null,8,["rounds"])])])])):W("",!0)]))],64))}}),Ea=ge($a,[["__scopeId","data-v-b55715ad"]]);export{Ea as default};
